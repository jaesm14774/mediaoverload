# MediaOverload ç­–ç•¥åŸ·è¡Œæµç¨‹èªªæ˜

## æ•´é«”æ¶æ§‹

ç³»çµ±æ¡ç”¨ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰ï¼Œæ¯å€‹ç­–ç•¥éƒ½ç¹¼æ‰¿è‡ª `ContentStrategy` åŸºé¡ï¼Œå¯¦ç¾ä»¥ä¸‹æ ¸å¿ƒæ–¹æ³•ï¼š
- `generate_description()` - ç”Ÿæˆæè¿°/æç¤ºè©
- `generate_media()` - ç”Ÿæˆåª’é«”ï¼ˆåœ–ç‰‡/å½±ç‰‡ï¼‰
- `analyze_media_text_match()` - åˆ†æåª’é«”èˆ‡æ–‡æœ¬åŒ¹é…åº¦ï¼ˆLLM è‡ªå‹•åˆ†æï¼‰
- `needs_user_review()` - æ˜¯å¦éœ€è¦ä½¿ç”¨è€…å¯©æ ¸
- `get_review_items()` - ç²å–éœ€è¦å¯©æ ¸çš„é …ç›®
- `handle_review_result()` - è™•ç†å¯©æ ¸çµæœ
- `should_generate_article_now()` - æ˜¯å¦ç¾åœ¨ç”Ÿæˆæ–‡ç« å…§å®¹

## ğŸš€ æ‰¹é‡ç”ŸæˆåŠŸèƒ½

æ”¯æ´å¾è³‡æ–™åº«æ‰¹é‡å– news æˆ–ä½¿ç”¨è‡ªå®šç¾© prompts é€²è¡Œæ‰¹é‡ç”Ÿæˆï¼š

**ä¸»è¦åŠŸèƒ½**ï¼š
1. **å¾è³‡æ–™åº«æ‰¹é‡ç”Ÿæˆ**ï¼šè‡ªå‹•å¾è³‡æ–™åº«å–å¤šå€‹ newsï¼Œæ‰¹é‡ç”¢ç”ŸæŒ‡å®šæ•¸é‡çš„å…§å®¹
2. **è‡ªå®šç¾© prompts æ‰¹é‡ç”Ÿæˆ**ï¼šä½¿ç”¨æä¾›çš„ prompts åˆ—è¡¨æ‰¹é‡ç”Ÿæˆ
3. **æ”¯æ´æ‰€æœ‰ç­–ç•¥**ï¼šText2Imageã€Text2Videoã€Text2LongVideoã€StickerPack ç­‰
4. **é•·å½±ç‰‡ç›´æ¥æ¨¡å¼**ï¼šä¸ä¿å­˜ä¸­é–“åœ–ç‰‡ï¼Œåªè¼¸å‡ºæœ€çµ‚å®Œæ•´å½±ç‰‡ï¼ˆå« TTSï¼‰

**ä½¿ç”¨ç¯„ä¾‹**ï¼ˆåœ¨ Jupyter Notebook ä¸­ï¼‰ï¼š

```python
# æ‰¹é‡ç”Ÿæˆ 30 å¼µåœ–ç‰‡
results = batch_generate_by_count(
    strategy_type='text2image',
    num_total=30,
    use_news=True,
    character="kirby",
    num_images=4
)

# æ‰¹é‡ç”Ÿæˆé•·å½±ç‰‡ï¼ˆç›´æ¥æ¨¡å¼ï¼‰
results = batch_generate_by_count(
    strategy_type='text2longvideo',
    num_total=2,
    use_news=True,
    character="kirby",
    skip_candidate_stage=True,  # ä¸ä¿å­˜ä¸­é–“åœ–ç‰‡
    segment_count=3,
    use_tts=True
)
```

è©³ç´°ç¯„ä¾‹è«‹åƒè€ƒ `examples/all_strategies_examples.ipynb`

## é‡è¦å®šç¾©

### å¯©æ ¸ï¼ˆReviewï¼‰çš„å®šç¾©

**å¯©æ ¸ = ä¸Šå‚³åª’é«”åˆ° Discordï¼Œè®“ä½¿ç”¨è€…äººå·¥é¸æ“‡è¦ä½¿ç”¨çš„åª’é«”**

å¯©æ ¸æµç¨‹ï¼š
1. ç³»çµ±å°‡åª’é«”æ–‡ä»¶ï¼ˆåœ–ç‰‡/å½±ç‰‡ï¼‰ä¸Šå‚³åˆ° Discord é »é“
2. ä½¿ç”¨è€…é€é Discord ä»‹é¢æŸ¥çœ‹åª’é«”
3. ä½¿ç”¨è€…é¸æ“‡è¦ä½¿ç”¨çš„åª’é«”ï¼ˆé€é Discord åæ‡‰æˆ–æŒ‡ä»¤ï¼‰
4. ç³»çµ±æ¥æ”¶ä½¿ç”¨è€…çš„é¸æ“‡ï¼Œç¹¼çºŒå¾ŒçºŒæµç¨‹

**æ³¨æ„**ï¼š
- å¯©æ ¸æ˜¯**äººå·¥å¯©æ ¸**ï¼Œä¸æ˜¯è‡ªå‹•é¸æ“‡
- å¯©æ ¸ç™¼ç”Ÿåœ¨**ç™¼å¸ƒåˆ°ç¤¾ç¾¤åª’é«”ä¹‹å‰**
- å¯©æ ¸å¯ä»¥è®“ä½¿ç”¨è€…ç·¨è¼¯æ–‡ç« å…§å®¹
- å¯©æ ¸å¯ä»¥é¸æ“‡å¤šå€‹åª’é«”ï¼ˆæœ€å¤š 10 å€‹ï¼Œç¬¦åˆ Discord API é™åˆ¶ï¼‰

**èˆ‡ LLM åˆ†æçš„å€åˆ¥**ï¼š
- `analyze_media_text_match()` - LLM è‡ªå‹•åˆ†æåª’é«”èˆ‡æ–‡æœ¬åŒ¹é…åº¦ï¼Œç”¨æ–¼**åˆæ­¥ç¯©é¸**
- `review_content()` - äººå·¥å¯©æ ¸ï¼Œç”¨æ–¼**æœ€çµ‚ç¢ºèª**è¦ç™¼å¸ƒçš„åª’é«”

## åŸ·è¡Œæµç¨‹ï¼ˆOrchestrationServiceï¼‰

### ä¸»è¦æµç¨‹æ­¥é©Ÿ

1. **è§’è‰²é¸æ“‡** - å¾ç¾¤çµ„ä¸­éš¨æ©Ÿé¸æ“‡è§’è‰²ï¼ˆç‰¹æ®Šæƒ…æ³ï¼šKirby ç¾¤çµ„çš„é•·å½±ç‰‡ç›´æ¥ä½¿ç”¨ kirbyï¼‰
2. **ç”Ÿæˆæç¤ºè©** - ä½¿ç”¨ PromptService ç”Ÿæˆåˆå§‹æç¤ºè©
3. **æº–å‚™é…ç½®** - å‰µå»º GenerationConfig
4. **ç”Ÿæˆå…§å®¹ï¼ˆç¬¬ä¸€éšæ®µï¼‰** - èª¿ç”¨ ContentGenerationService.generate_content()
5. **æª¢æŸ¥æ˜¯å¦éœ€è¦å¯©æ ¸** - èª¿ç”¨ strategy.needs_user_review()
6. **Discord äººå·¥å¯©æ ¸æµç¨‹**ï¼ˆå¦‚æœéœ€è¦ï¼‰
   - ç²å–éœ€è¦å¯©æ ¸çš„åª’é«”é …ç›®ï¼ˆæœ€å¤š 10 å€‹ï¼Œç¬¦åˆ Discord API é™åˆ¶ï¼‰
   - **ä¸Šå‚³åª’é«”åˆ° Discord é »é“**ï¼Œè®“ä½¿ç”¨è€…æŸ¥çœ‹
   - **ä½¿ç”¨è€…é€é Discord é¸æ“‡**è¦ä½¿ç”¨çš„åª’é«”
   - **ä½¿ç”¨è€…å¯ä»¥ç·¨è¼¯æ–‡ç« å…§å®¹**ï¼ˆå¯é¸ï¼‰
   - ç³»çµ±æ¥æ”¶ä½¿ç”¨è€…çš„é¸æ“‡ï¼ˆ`selected_indices`ï¼‰
   - è™•ç†å¯©æ ¸çµæœï¼ˆèª¿ç”¨ strategy.handle_review_result()ï¼‰
   - é‡æ–°åˆ†æçµæœï¼ˆç²å–æœ€çµ‚çš„åª’é«”ï¼‰
   - æª¢æŸ¥æ˜¯å¦éœ€è¦å†æ¬¡å¯©æ ¸ï¼ˆä¾‹å¦‚ï¼šå½±ç‰‡ç”Ÿæˆå¾Œï¼‰
7. **å¾Œè™•ç†åª’é«”** - èª¿ç”¨ strategy.post_process_media()ï¼ˆä¾‹å¦‚ï¼šåœ–ç‰‡æ”¾å¤§ï¼‰
8. **è™•ç†åª’é«”æ ¼å¼** - è½‰æ›æ ¼å¼ç­‰
9. **ç™¼å¸ƒåˆ°ç¤¾ç¾¤åª’é«”** - Instagramã€Twitter ç­‰
10. **ç™¼é€é€šçŸ¥**
11. **æ¸…ç†è³‡æº**

---

## å„ç­–ç•¥è©³ç´°æµç¨‹

### 1. Text2ImageStrategyï¼ˆæ–‡å­—ç”Ÿæˆåœ–ç‰‡ï¼‰

#### åŸ·è¡Œæµç¨‹

```
generate_description()
  â†“
  æ ¹æ“š image_system_prompt_weights éš¨æ©Ÿé¸æ“‡ system prompt
  ï¼ˆæ”¯æ´ï¼šstable_diffusion_prompt, warm_scene_description_system_prompt, 
   sticker_prompt_system_prompt, two_character_interaction_generate_system_promptï¼‰
  â†“
  ä½¿ç”¨ VisionManager ç”Ÿæˆåœ–ç‰‡æè¿°
  â†“
generate_media()
  â†“
  æ ¹æ“šæè¿°ç”Ÿæˆå¤šå¼µåœ–ç‰‡ï¼ˆé è¨­æ¯å€‹æè¿° 4 å¼µï¼‰
  â†“
analyze_media_text_match()
  â†“
  ä½¿ç”¨ VisionManager åˆ†æåœ–ç‰‡èˆ‡æè¿°çš„åŒ¹é…åº¦
  â†“
generate_article_content()
  â†“
  åŸºæ–¼ filter_results ç”Ÿæˆæ–‡ç« å…§å®¹ï¼ˆhashtagsï¼‰
```

#### ç‰¹é»
- **éœ€è¦ä½¿ç”¨è€…å¯©æ ¸**ï¼ˆ`needs_user_review()` è¿”å› Trueï¼Œç•¶æœ‰ filter_results æ™‚ï¼‰
- ä½¿ç”¨è€…é¸æ“‡æœ€çµ‚è¦ç™¼å¸ƒçš„åœ–ç‰‡
- æ”¯æ´åœ–ç‰‡æ”¾å¤§ï¼ˆ`post_process_media()` å¯é¸ï¼‰
- ç›´æ¥ç”Ÿæˆæ–‡ç« å…§å®¹

#### é…ç½®åƒæ•¸
- `images_per_description`: æ¯å€‹æè¿°ç”Ÿæˆå¹¾å¼µåœ–ç‰‡ï¼ˆé è¨­ 4ï¼‰
- `enable_upscale`: æ˜¯å¦å•Ÿç”¨åœ–ç‰‡æ”¾å¤§
- `upscale_workflow_path`: æ”¾å¤§å·¥ä½œæµè·¯å¾‘

---

### 2. Text2Image2ImageStrategyï¼ˆæ–‡å­—â†’åœ–ç‰‡â†’åœ–ç‰‡ï¼‰

#### åŸ·è¡Œæµç¨‹

```
generate_description()
  â†“
  ç”Ÿæˆç¬¬ä¸€éšæ®µåœ–ç‰‡æè¿°
  â†“
generate_media()
  â†“
ã€ç¬¬ä¸€éšæ®µï¼šText to Imageã€‘
  ç”Ÿæˆå¤šå¼µå€™é¸åœ–ç‰‡ï¼ˆé è¨­æ¯å€‹æè¿° 4 å¼µï¼‰
  â†“
  ä½¿ç”¨ VisionManager ç¯©é¸æœ€ä½³åœ–ç‰‡ï¼ˆsimilarity_threshold=0.0ï¼‰
  â†“
ã€ç¬¬äºŒéšæ®µï¼šImage to Imageã€‘
  å°æ¯å¼µé¸ä¸­çš„åœ–ç‰‡é€²è¡Œ I2I è™•ç†ï¼ˆé è¨­æ¯å¼µ 1 å€‹è®Šé«”ï¼‰
  â†“
analyze_media_text_match()
  â†“
  åˆ†æç¬¬äºŒéšæ®µç”Ÿæˆçš„åœ–ç‰‡
  â†“
generate_article_content()
  â†“
  ç”Ÿæˆæ–‡ç« å…§å®¹
```

#### ç‰¹é»
- **éœ€è¦ä½¿ç”¨è€…å¯©æ ¸**ï¼ˆ`needs_user_review()` è¿”å› Trueï¼Œç•¶æœ‰ filter_results æ™‚ï¼‰
- ä½¿ç”¨è€…é¸æ“‡æœ€çµ‚è¦ç™¼å¸ƒçš„åœ–ç‰‡
- å…©éšæ®µç”Ÿæˆï¼šå…ˆ T2Iï¼Œå† I2I ç²¾ç…‰
- è‡ªå‹•ç¯©é¸æœ€ä½³åœ–ç‰‡é€²å…¥ç¬¬äºŒéšæ®µ

#### é…ç½®åƒæ•¸
- `first_stage.images_per_description`: ç¬¬ä¸€éšæ®µæ¯å€‹æè¿°ç”Ÿæˆå¹¾å¼µï¼ˆé è¨­ 4ï¼‰
- `second_stage.images_per_input`: ç¬¬äºŒéšæ®µæ¯å¼µè¼¸å…¥åœ–ç‰‡ç”Ÿæˆå¹¾å€‹è®Šé«”ï¼ˆé è¨­ 1ï¼‰

---

### 3. Text2Image2VideoStrategyï¼ˆæ–‡å­—â†’åœ–ç‰‡â†’å½±ç‰‡ï¼‰

#### åŸ·è¡Œæµç¨‹

```
generate_description()
  â†“
  ç”Ÿæˆåœ–ç‰‡æè¿°
  â†“
generate_media()
  â†“
ã€ç¬¬ä¸€éšæ®µï¼šText to Imageã€‘
  ç”Ÿæˆå¤šå¼µå€™é¸åœ–ç‰‡ï¼ˆé è¨­æ¯å€‹æè¿° 4 å¼µï¼‰
  â†“
needs_user_review() â†’ Trueï¼ˆåœ–ç‰‡å·²ç”Ÿæˆï¼Œå½±ç‰‡æœªç”Ÿæˆï¼‰
  â†“
ã€Discord å¯©æ ¸ï¼šé¸æ“‡åœ–ç‰‡ã€‘
  â†“
handle_review_result()
  â†“
ã€ç¬¬äºŒéšæ®µï¼šImage to Videoã€‘
  å°æ¯å¼µé¸ä¸­çš„åœ–ç‰‡ï¼š
    1. æå–åœ–ç‰‡å…§å®¹
    2. ç”Ÿæˆå½±ç‰‡æè¿°
    3. ç”ŸæˆéŸ³è¨Šæè¿°
    4. ä½¿ç”¨ I2V workflow ç”Ÿæˆå½±ç‰‡ï¼ˆé è¨­æ¯å¼µåœ–ç‰‡ 1 å€‹å½±ç‰‡ï¼‰
  â†“
needs_user_review() â†’ Trueï¼ˆå½±ç‰‡å·²ç”Ÿæˆï¼Œæœªå¯©æ ¸ï¼‰
  â†“
ã€Discord å¯©æ ¸ï¼šé¸æ“‡å½±ç‰‡ã€‘
  â†“
handle_review_result()
  â†“
analyze_media_text_match()
  â†“
  åˆ†æå½±ç‰‡æ–‡ä»¶ï¼ˆä½¿ç”¨å½±ç‰‡æè¿°ï¼‰
  â†“
should_generate_article_now() â†’ Trueï¼ˆå½±ç‰‡å·²ç”Ÿæˆï¼‰
  â†“
generate_article_content()
  â†“
  åŸºæ–¼å½±ç‰‡æè¿°ç”Ÿæˆæ–‡ç« å…§å®¹
```

#### ç‰¹é»
- **éœ€è¦å…©æ¬¡ä½¿ç”¨è€…å¯©æ ¸**
  1. ç¬¬ä¸€æ¬¡ï¼šé¸æ“‡è¦ç”Ÿæˆå½±ç‰‡çš„åœ–ç‰‡
  2. ç¬¬äºŒæ¬¡ï¼šé¸æ“‡æœ€çµ‚è¦ç™¼å¸ƒçš„å½±ç‰‡
- å»¶é²ç”Ÿæˆæ–‡ç« å…§å®¹ï¼ˆç›´åˆ°å½±ç‰‡ç”Ÿæˆå¾Œï¼‰
- è‡ªå‹•ç”Ÿæˆå½±ç‰‡æè¿°å’ŒéŸ³è¨Šæè¿°

#### ç‹€æ…‹ç®¡ç†
- `_videos_generated`: æ¨™è¨˜å½±ç‰‡æ˜¯å¦å·²ç”Ÿæˆ
- `_videos_reviewed`: æ¨™è¨˜å½±ç‰‡æ˜¯å¦å·²å¯©æ ¸
- `video_descriptions`: å„²å­˜æ¯å¼µåœ–ç‰‡å°æ‡‰çš„å½±ç‰‡æè¿°
- `audio_descriptions`: å„²å­˜æ¯å¼µåœ–ç‰‡å°æ‡‰çš„éŸ³è¨Šæè¿°

#### é…ç½®åƒæ•¸
- `first_stage.images_per_description`: ç¬¬ä¸€éšæ®µæ¯å€‹æè¿°ç”Ÿæˆå¹¾å¼µåœ–ç‰‡ï¼ˆé è¨­ 4ï¼‰
- `video.videos_per_image`: æ¯å¼µåœ–ç‰‡ç”Ÿæˆå¹¾å€‹å½±ç‰‡ï¼ˆé è¨­ 1ï¼‰
- `video.i2v_workflow_path`: I2V å·¥ä½œæµè·¯å¾‘

---

### 4. Text2VideoStrategyï¼ˆæ–‡å­—ç”Ÿæˆå½±ç‰‡ï¼‰

#### åŸ·è¡Œæµç¨‹

```
generate_description()
  â†“
  å…©éšæ®µæè¿°ç”Ÿæˆï¼š
    1. ç”Ÿæˆè§’è‰²æè¿°
    2. åŸºæ–¼è§’è‰²æè¿°ç”Ÿæˆå½±ç‰‡æè¿°
  â†“
generate_media()
  â†“
  ç›´æ¥ç”Ÿæˆå½±ç‰‡ï¼ˆé è¨­æ¯å€‹æè¿° 2 å€‹å½±ç‰‡ï¼‰
  â†“
analyze_media_text_match()
  â†“
  ç°¡åŒ–åˆ†æï¼šè¿”å›æ‰€æœ‰å½±ç‰‡ï¼ˆsimilarity=1.0ï¼‰
  â†“
generate_article_content()
  â†“
  ç”Ÿæˆæ–‡ç« å…§å®¹
```

#### ç‰¹é»
- **éœ€è¦ä½¿ç”¨è€…å¯©æ ¸**ï¼ˆ`needs_user_review()` è¿”å› Trueï¼Œç•¶æœ‰ filter_results æ™‚ï¼‰
- ä½¿ç”¨è€…é¸æ“‡æœ€çµ‚è¦ç™¼å¸ƒçš„å½±ç‰‡
- ç›´æ¥å¾æ–‡å­—ç”Ÿæˆå½±ç‰‡ï¼ˆä¸ç¶“éåœ–ç‰‡éšæ®µï¼‰
- å…©éšæ®µæè¿°ç”Ÿæˆï¼šå…ˆè§’è‰²æè¿°ï¼Œå†å½±ç‰‡æè¿°

#### é…ç½®åƒæ•¸
- `videos_per_description`: æ¯å€‹æè¿°ç”Ÿæˆå¹¾å€‹å½±ç‰‡ï¼ˆé è¨­ 2ï¼‰

---

### 5. Text2LongVideoStrategyï¼ˆæ–‡å­—ç”Ÿæˆé•·å½±ç‰‡ - å°¾å¹€é©…å‹•ï¼Œå·²å„ªåŒ–ï¼‰

#### âœ¨ æœ€æ–°å„ªåŒ–ï¼ˆ2025-12-17ï¼‰

1. **I2I å¹€è½‰æ›**ï¼šä½¿ç”¨ nova-anime-xl çš„ I2I workflow é‡æ–°ç”Ÿæˆé«˜è³ªé‡ç¬¬ä¸€å¹€
   - è§£æ±ºå•é¡Œï¼šwan2.2 æ²’æœ‰è§’è‰²çŸ¥è­˜ï¼Œç›´æ¥ä½¿ç”¨æœ€å¾Œä¸€å¹€æœƒå°è‡´è§’è‰²å´©å£
   - è§£æ±ºæ–¹æ¡ˆï¼šåœ¨æ¯å€‹æ®µè½ä¹‹é–“ä½¿ç”¨ I2I é‡æ–°ç”Ÿæˆï¼Œç¢ºä¿è§’è‰²æº–ç¢ºæ€§
   - é…ç½®ï¼š`frame_transition.enabled = true`

2. **åŠ‡æƒ…æ¨é€²å„ªåŒ–**ï¼šåŸºæ–¼æ–°è…³æœ¬æè¿°é€²è¡Œ I2I è½‰æ›
   - è§£æ±ºå•é¡Œï¼šåŠ‡æƒ…åœæ»¯ï¼Œçœ‹èµ·ä¾†åƒé‡è¤‡çš„ 6 ç§’å½±ç‰‡
   - è§£æ±ºæ–¹æ¡ˆï¼šI2I è½‰æ›æ™‚ä½¿ç”¨ä¸‹ä¸€æ®µçš„è¦–è¦ºæè¿°ï¼Œç¢ºä¿åŠ‡æƒ…æ¨é€²

3. **TTS éŸ³è¨Šç”Ÿæˆæ”¹é€²**ï¼š
   - å¢å¼·éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„
   - ç¢ºä¿éŸ³è¨Šæ–‡ä»¶æ­£ç¢ºç”Ÿæˆå’Œåˆä½µ
   - æ›´å¥½çš„å¤±æ•—é™ç´šè™•ç†

#### åŸ·è¡Œæµç¨‹

**æ¨¡å¼ 1ï¼šå€™é¸åœ–ç‰‡æ¨¡å¼ï¼ˆé è¨­ï¼‰**
```
generate_description()
  â†“
  ç”Ÿæˆç¬¬ä¸€å€‹æ®µè½çš„è…³æœ¬ï¼ˆåŒ…å«è¦–è¦ºæè¿°å’Œæ—ç™½ï¼‰
  â†“
generate_media()
  â†“
  ç”Ÿæˆç¬¬ä¸€å€‹æ®µè½çš„å€™é¸åœ–ç‰‡ï¼ˆé è¨­ 3 å¼µï¼‰
  â†“
needs_user_review() â†’ True
  â†“
ã€Discord å¯©æ ¸ï¼šé¸æ“‡ç¬¬ä¸€å¹€åœ–ç‰‡ã€‘
  â†“
handle_review_result()
  â†“
_generate_full_video_loop()
  â†“
ã€å¾ªç’°ç”Ÿæˆå¤šå€‹æ®µè½ã€‘
  å°æ¯å€‹æ®µè½ï¼ˆé è¨­ 5 å€‹æ®µè½ï¼‰ï¼š
    1. å¦‚æœä¸æ˜¯ç¬¬ä¸€æ®µï¼ŒåŸºæ–¼ä¸Šä¸€æ®µæœ€å¾Œä¸€å¹€ç”Ÿæˆè…³æœ¬
    2. ä¸Šå‚³ç•¶å‰å¹€åœ–ç‰‡
    3. ä½¿ç”¨ I2V ç”Ÿæˆè©²æ®µè½çš„å½±ç‰‡
    4. å¾å½±ç‰‡æå–æœ€å¾Œä¸€å¹€
    5. âœ¨å„ªåŒ–ï¼šå¦‚æœä¸æ˜¯æœ€å¾Œä¸€æ®µï¼Œä½¿ç”¨ I2Iï¼ˆnova-anime-xlï¼‰é‡æ–°ç”Ÿæˆé«˜è³ªé‡ç¬¬ä¸€å¹€
       - é¿å…è§’è‰²å´©å£ï¼ˆwan2.2 æ²’æœ‰è§’è‰²çŸ¥è­˜ï¼‰
       - ç¢ºä¿åŠ‡æƒ…æ¨é€²ï¼ˆåŸºæ–¼æ–°è…³æœ¬æè¿°ï¼‰
       - ä¿æŒè¦–è¦ºé€£çºŒæ€§
  â†“
ã€å¾Œè™•ç†ã€‘
  1. åˆä½µæ‰€æœ‰æ®µè½å½±ç‰‡ç‚ºä¸€å€‹å®Œæ•´å½±ç‰‡
  2. å¦‚æœå•Ÿç”¨ TTSï¼š
     - ç‚ºæ¯å€‹æ®µè½ç”Ÿæˆ TTS éŸ³è¨Š
     - åˆä½µæ‰€æœ‰éŸ³è¨Š
     - å°‡éŸ³è¨Šèˆ‡å½±ç‰‡åˆä½µ
  â†“
_generate_final_article_content()
  â†“
  åŸºæ–¼æ‰€æœ‰æ®µè½çš„è…³æœ¬ç”Ÿæˆæœ€çµ‚æ–‡ç« å…§å®¹
```

**æ¨¡å¼ 2ï¼šç›´æ¥ç”Ÿæˆæ¨¡å¼ï¼ˆskip_candidate_stage=Trueï¼‰**
```
generate_description()
  â†“
  ç”Ÿæˆç¬¬ä¸€å€‹æ®µè½çš„è…³æœ¬
  â†“
generate_media()
  â†“
  âœ¨ è·³éå€™é¸åœ–ç‰‡éšæ®µ
  â†“
_generate_full_video_direct()
  â†“
  1. ç›´æ¥ç”Ÿæˆç¬¬ä¸€å¹€åœ–ç‰‡
  2. ä½¿ç”¨ç¬¬ä¸€å¹€é–‹å§‹å®Œæ•´å½±ç‰‡å¾ªç’°
  3. ç”Ÿæˆæ‰€æœ‰æ®µè½å½±ç‰‡
  4. åˆä½µæ®µè½ç‚ºå®Œæ•´å½±ç‰‡
  5. å¦‚æœå•Ÿç”¨ TTSï¼Œæ·»åŠ æ—ç™½
  6. âœ¨ ä¸ä¿å­˜ä¸­é–“åœ–ç‰‡ï¼Œåªè¼¸å‡ºæœ€çµ‚å®Œæ•´å½±ç‰‡
  7. æ¸…ç†è‡¨æ™‚æª”æ¡ˆ
  â†“
_generate_final_article_content()
  â†“
  åŸºæ–¼æ‰€æœ‰æ®µè½çš„è…³æœ¬ç”Ÿæˆæœ€çµ‚æ–‡ç« å…§å®¹
```

#### ç‰¹é»
- **å…©ç¨®ç”Ÿæˆæ¨¡å¼**ï¼š
  - å€™é¸åœ–ç‰‡æ¨¡å¼ï¼šéœ€è¦å…©æ¬¡ä½¿ç”¨è€…å¯©æ ¸
  - ç›´æ¥ç”Ÿæˆæ¨¡å¼ï¼šç„¡éœ€å¯©æ ¸ï¼Œè‡ªå‹•ç”Ÿæˆå®Œæ•´å½±ç‰‡
- å¤šæ®µè½ç”Ÿæˆï¼šæ¯å€‹æ®µè½åŸºæ–¼ä¸Šä¸€æ®µçš„æœ€å¾Œä¸€å¹€
- æ”¯æ´ TTS æ—ç™½
- è‡ªå‹•åˆä½µæ®µè½ç‚ºå®Œæ•´å½±ç‰‡
- **ç›´æ¥æ¨¡å¼å„ªå‹¢**ï¼šä¸ä¿å­˜ä¸­é–“åœ–ç‰‡ï¼Œåªè¼¸å‡ºæœ€çµ‚å®Œæ•´å½±ç‰‡

#### ç‹€æ…‹ç®¡ç†
- `script_segments`: å„²å­˜æ‰€æœ‰æ®µè½çš„è…³æœ¬
- `generated_media_paths`: å„²å­˜ç”Ÿæˆçš„åª’é«”è·¯å¾‘ï¼ˆæœ€çµ‚ç‚ºåˆä½µå¾Œçš„å½±ç‰‡ï¼‰

#### é…ç½®åƒæ•¸
- `longvideo_config.skip_candidate_stage`: æ˜¯å¦è·³éå€™é¸åœ–ç‰‡éšæ®µï¼ˆé è¨­ Falseï¼‰
- `longvideo_config.segment_count`: æ®µè½æ•¸é‡ï¼ˆé è¨­ 5ï¼‰
- `longvideo_config.segment_duration`: æ¯å€‹æ®µè½æ™‚é•·ï¼ˆé è¨­ 5 ç§’ï¼‰
- `longvideo_config.use_tts`: æ˜¯å¦ä½¿ç”¨ TTSï¼ˆé è¨­ Trueï¼‰
- `longvideo_config.tts_voice`: TTS èªéŸ³ï¼ˆé è¨­ 'en-US-AriaNeural'ï¼‰
- `first_stage.batch_size`: ç¬¬ä¸€å¹€å€™é¸åœ–ç‰‡æ•¸é‡ï¼ˆé è¨­ 3ï¼Œåƒ…å€™é¸æ¨¡å¼ï¼‰
- `frame_transition.enabled`: æ˜¯å¦å•Ÿç”¨ I2I å¹€è½‰æ›ï¼ˆé è¨­ trueï¼‰âœ¨æ–°å¢
- `frame_transition.workflow_path`: I2I å·¥ä½œæµè·¯å¾‘ï¼ˆé è¨­ image_to_image.jsonï¼‰âœ¨æ–°å¢
- `frame_transition.denoise`: I2I denoise å¼·åº¦ï¼ˆé è¨­ 0.6ï¼Œæ¨è–¦ 0.5-0.7ï¼‰âœ¨æ–°å¢
- `frame_transition.style_continuity_prompt`: é¢¨æ ¼é€£çºŒæ€§æç¤ºè©âœ¨æ–°å¢

---

### 7. StickerPackStrategyï¼ˆè²¼åœ–åŒ…ç”Ÿæˆï¼‰

#### åŸ·è¡Œæµç¨‹

```
generate_description()
  â†“
  ä½¿ç”¨ OpenRouter LLM è‡ªå‹•ç”Ÿæˆ 8 ç¨®è¡¨æƒ…æè¿°
  ï¼ˆhappy, sad, angry, surprised, love, sleepy, confused, excited ç­‰ï¼‰
  â†“
generate_media()
  â†“
  æ‰¹é‡ç”Ÿæˆ 8 å¼µéœæ…‹è²¼åœ–
  â†“
needs_user_review() â†’ True
  â†“
ã€Discord å¯©æ ¸ï¼šé¸æ“‡è¦ä½¿ç”¨çš„åœ–ç‰‡ã€‘
  â†“
handle_review_result()
  â†“
  éš¨æ©Ÿæ±ºå®šï¼ˆæ ¹æ“š gif_probabilityï¼‰ï¼š
    â”œâ”€ ç”Ÿæˆå‹•æ…‹ GIFï¼ˆæ©Ÿç‡ï¼šgif_probabilityï¼‰
    â”‚   â†“
    â”‚  _generate_animated_stickers()
    â”‚   â†“
    â”‚  å°é¸ä¸­çš„åœ–ç‰‡ï¼š
    â”‚    1. ä½¿ç”¨ I2V ç”ŸæˆçŸ­å½±ç‰‡
    â”‚    2. ä½¿ç”¨ FFmpeg è½‰æ›ç‚ºå„ªåŒ– GIF
    â”‚   â†“
    â”‚  needs_user_review() â†’ True
    â”‚   â†“
    â”‚  ã€Discord å¯©æ ¸ï¼šé¸æ“‡æœ€çµ‚è¦ç™¼å¸ƒçš„ GIFã€‘
    â”‚
    â””â”€ ä½¿ç”¨éœæ…‹è²¼åœ–ï¼ˆæ©Ÿç‡ï¼š1 - gif_probabilityï¼‰
        â†“
        ç›´æ¥è·³åˆ°ç”Ÿæˆæ–‡ç« å…§å®¹
  â†“
ç”Ÿæˆæ–‡ç« å…§å®¹
```

#### ç‰¹é»
- **LLM è‡ªå‹•ç”Ÿæˆè¡¨æƒ…**ï¼šä½¿ç”¨ OpenRouter éš¨æ©Ÿæ¨¡å‹ç”Ÿæˆå¤šæ¨£åŒ–è¡¨æƒ…
- **éš¨æ©Ÿå‹•æ…‹/éœæ…‹**ï¼šæ ¹æ“šé…ç½®çš„æ©Ÿç‡éš¨æ©Ÿæ±ºå®šç”Ÿæˆå‹•æ…‹ GIF æˆ–ä½¿ç”¨éœæ…‹è²¼åœ–ï¼Œå¢åŠ å…§å®¹å¤šæ¨£æ€§
- **çµ±ä¸€é¢¨æ ¼**ï¼šæ‰€æœ‰è²¼åœ–ä¿æŒä¸€è‡´çš„ LINE è²¼åœ–é¢¨æ ¼
- **GIF å„ªåŒ–**ï¼šä½¿ç”¨ FFmpeg äºŒéšæ®µè½‰æ›ï¼Œæœ€ä½³åŒ–æª”æ¡ˆå¤§å°
- **å‹•ä½œè£œå¹€**ï¼šä½¿ç”¨ minterpolate é€²è¡Œå¹€æ’å€¼ï¼Œè®“å‹•ç•«æ›´æµæš¢è‡ªç„¶
- **Instagram ç›¸å®¹**ï¼šè‡ªå‹•å°‡ GIF è½‰æ›ç‚º MP4 æ ¼å¼ä»¥ç¬¦åˆ Instagram ä¸Šå‚³è¦æ±‚

#### é…ç½®åƒæ•¸
```yaml
sticker_pack:
  style: "LINE sticker style, chibi proportions, white outline, simple background"
  
  static_config:
    workflow_path: /app/configs/workflow/nova-anime-xl.json
    images_per_expression: 1
  
  animated_config:
    enabled: true
    gif_probability: 0.5        # ç”Ÿæˆ GIF çš„æ©Ÿç‡ï¼ˆ0.0-1.0ï¼‰ï¼Œé è¨­ 0.5ï¼ˆ50%ï¼‰
    i2v_workflow_path: /app/configs/workflow/wan2.2_gguf_i2v.json
    # çŸ­å‹•ç•«åƒæ•¸ï¼ˆæ§åˆ¶ GIF é•·åº¦ï¼‰
    total_frames: 33        # ç¸½å¹€æ•¸ï¼ˆ33 frames / 12 fps â‰ˆ 2.75 ç§’ï¼‰
    video_fps: 12           # å½±ç‰‡ fps
    # GIF è½‰æ›åƒæ•¸
    gif_fps: 10             # GIF fps
    gif_max_colors: 256
    gif_scale_width: 512
```

---

## å¯©æ ¸æµç¨‹è©³è§£

### å¯©æ ¸è§¸ç™¼æ¢ä»¶

ç­–ç•¥é€šé `needs_user_review()` æ–¹æ³•æ±ºå®šæ˜¯å¦éœ€è¦**ä¸Šå‚³åˆ° Discord è®“ä½¿ç”¨è€…é¸æ“‡**ï¼š

1. **Text2ImageStrategy**
   - `len(filter_results) > 0`ï¼ˆæœ‰ LLM åˆ†æçµæœæ™‚ï¼Œéœ€è¦äººå·¥å¯©æ ¸ç¢ºèªï¼‰

2. **Text2Image2ImageStrategy**
   - `len(filter_results) > 0`ï¼ˆæœ‰ LLM åˆ†æçµæœæ™‚ï¼Œéœ€è¦äººå·¥å¯©æ ¸ç¢ºèªï¼‰

3. **Text2VideoStrategy**
   - `len(filter_results) > 0`ï¼ˆæœ‰ LLM åˆ†æçµæœæ™‚ï¼Œéœ€è¦äººå·¥å¯©æ ¸ç¢ºèªï¼‰

4. **Text2Image2VideoStrategy**
   - ç¬¬ä¸€æ¬¡ï¼š`len(first_stage_images) > 0 and not _videos_generated`ï¼ˆåœ–ç‰‡å·²ç”Ÿæˆï¼Œéœ€è¦é¸æ“‡è¦ç”Ÿæˆå½±ç‰‡çš„åœ–ç‰‡ï¼‰
   - ç¬¬äºŒæ¬¡ï¼š`_videos_generated and not _videos_reviewed`ï¼ˆå½±ç‰‡å·²ç”Ÿæˆï¼Œéœ€è¦é¸æ“‡æœ€çµ‚è¦ç™¼å¸ƒçš„å½±ç‰‡ï¼‰

5. **Text2LongVideoStrategy**
   - ç¬¬ä¸€æ¬¡ï¼š`len(generated_media_paths) > 0`ï¼ˆå€™é¸åœ–ç‰‡å·²ç”Ÿæˆï¼Œéœ€è¦é¸æ“‡ç¬¬ä¸€å¹€ï¼‰
   - ç¬¬äºŒæ¬¡ï¼š`len(generated_media_paths) > 0`ï¼ˆæœ€çµ‚å½±ç‰‡å·²ç”Ÿæˆï¼Œéœ€è¦é¸æ“‡æœ€çµ‚è¦ç™¼å¸ƒçš„å½±ç‰‡ï¼‰

### å¯©æ ¸é …ç›®ç²å–

`get_review_items(max_items=10)` æ–¹æ³•è¿”å›éœ€è¦**ä¸Šå‚³åˆ° Discord** çš„åª’é«”é …ç›®ï¼š
- **é™åˆ¶**ï¼šæœ€å¤š 10 å€‹é …ç›®ï¼ˆç¬¦åˆ Discord API é™åˆ¶ï¼‰
- **æ ¼å¼**ï¼š`[{'media_path': '...', 'similarity': ...}, ...]`
- **ç”¨é€”**ï¼šé€™äº›åª’é«”æœƒè¢«ä¸Šå‚³åˆ° Discordï¼Œè®“ä½¿ç”¨è€…é¸æ“‡

### å¯©æ ¸çµæœè™•ç†

`handle_review_result(selected_indices, output_dir)` æ–¹æ³•è™•ç†**ä½¿ç”¨è€…åœ¨ Discord ä¸­çš„é¸æ“‡**ï¼š
- `selected_indices`: ä½¿ç”¨è€…åœ¨ Discord ä¸­é¸æ“‡çš„ç´¢å¼•åˆ—è¡¨ï¼ˆç›¸å°æ–¼ `get_review_items()` è¿”å›çš„åˆ—è¡¨ï¼‰
- æ ¹æ“šç­–ç•¥ä¸åŒï¼Œå¯èƒ½è§¸ç™¼ï¼š
  - ç”Ÿæˆå½±ç‰‡ï¼ˆText2Image2VideoStrategyï¼‰
  - ç”Ÿæˆå¾ŒçºŒæ®µè½ï¼ˆText2LongVideoStrategyï¼‰
  - åœ–ç‰‡æ”¾å¤§ï¼ˆText2ImageStrategyï¼Œå¦‚æœå•Ÿç”¨ï¼‰
  - æˆ–è€…ç›´æ¥ä½¿ç”¨é¸æ“‡çš„åª’é«”é€²è¡Œå¾ŒçºŒè™•ç†

### å¯©æ ¸å¾Œçš„åª’é«”è·¯å¾‘æå–

**é‡è¦**ï¼šåœ¨ `orchestration_service.py` ä¸­ï¼Œåª’é«”è·¯å¾‘æå–é‚è¼¯ï¼š

1. **å¦‚æœ `selected_result_already_filtered = True`**
   - `selected_result` å·²ç¶“æ ¹æ“š `selected_indices` éæ¿¾é
   - ç›´æ¥å¾ `selected_result` æå–æ‰€æœ‰åª’é«”è·¯å¾‘

2. **å¦‚æœ `selected_result_already_filtered = False`**
   - `selected_result` å°šæœªéæ¿¾
   - ä½¿ç”¨ `selected_indices` ç´¢å¼• `selected_result` ä¾†æå–åª’é«”è·¯å¾‘

é€™ç¢ºä¿äº†ç„¡è«–å¯©æ ¸æµç¨‹å¦‚ä½•ï¼Œéƒ½èƒ½æ­£ç¢ºæå–ä½¿ç”¨è€…é¸æ“‡çš„åª’é«”ã€‚

---

## æ–‡ç« å…§å®¹ç”Ÿæˆæ™‚æ©Ÿ

### ç«‹å³ç”Ÿæˆï¼ˆ`should_generate_article_now() = True`ï¼‰

- **Text2ImageStrategy** - å¯©æ ¸å¾Œç«‹å³ç”Ÿæˆ
- **Text2Image2ImageStrategy** - å¯©æ ¸å¾Œç«‹å³ç”Ÿæˆ
- **Text2VideoStrategy** - å¯©æ ¸å¾Œç«‹å³ç”Ÿæˆ
- **Text2LongVideoStrategy** - æœ€çµ‚å½±ç‰‡ç”Ÿæˆå¾Œç«‹å³ç”Ÿæˆ

### å»¶é²ç”Ÿæˆï¼ˆ`should_generate_article_now() = False`ï¼‰

- **Text2Image2VideoStrategy**
  - åœ¨åœ–ç‰‡éšæ®µï¼šä¸ç”Ÿæˆæ–‡ç« å…§å®¹
  - åœ¨å½±ç‰‡ç”Ÿæˆå¾Œï¼šç”ŸæˆåŸºæ–¼å½±ç‰‡æè¿°çš„æ–‡ç« å…§å®¹

---

## å¾Œè™•ç†åª’é«”

### åœ–ç‰‡æ”¾å¤§ï¼ˆUpscaleï¼‰

#### Text2ImageStrategy
æ”¯æ´å¯é¸çš„åœ–ç‰‡æ”¾å¤§ï¼š
- é…ç½®ï¼š`enable_upscale = True`
- å·¥ä½œæµï¼š`upscale_workflow_path`
- è™•ç†ï¼šå°æ¯å¼µé¸ä¸­çš„åœ–ç‰‡é€²è¡Œæ”¾å¤§è™•ç†

#### Text2Image2VideoStrategy
æ”¯æ´å¯é¸çš„åœ–ç‰‡æ”¾å¤§ï¼š
- é…ç½®ï¼š`first_stage.enable_upscale = True`
- å·¥ä½œæµï¼š`first_stage.upscale_workflow_path`
- è™•ç†æµç¨‹ï¼š
  1. ä½¿ç”¨è€…é¸æ“‡åœ–ç‰‡å¾Œï¼Œå…ˆå°é¸ä¸­çš„åœ–ç‰‡é€²è¡Œæ”¾å¤§
  2. ä½¿ç”¨æ”¾å¤§å¾Œçš„åœ–ç‰‡ç”Ÿæˆå½±ç‰‡
  3. ä½¿ç”¨è€…å†é¸æ“‡æœ€çµ‚è¦ç™¼å¸ƒçš„å½±ç‰‡

#### Text2LongVideoStrategy
æ”¯æ´å¯é¸çš„åœ–ç‰‡æ”¾å¤§ï¼š
- é…ç½®ï¼š`first_stage.enable_upscale = True`
- å·¥ä½œæµï¼š`first_stage.upscale_workflow_path`
- è™•ç†æµç¨‹ï¼š
  1. å°ç¬¬ä¸€å¹€é€²è¡Œæ”¾å¤§å¾Œç”Ÿæˆç¬¬ä¸€å€‹å½±ç‰‡æ®µè½
  2. å°æ¯å€‹å½±ç‰‡æ®µè½çš„æœ€å¾Œä¸€å¹€é€²è¡Œæ”¾å¤§
  3. ä½¿ç”¨æ”¾å¤§å¾Œçš„å¹€ä½œç‚ºä¸‹ä¸€å€‹æ®µè½çš„è¼¸å…¥

### å…¶ä»–ç­–ç•¥

- **Text2Image2ImageStrategy**: ç„¡å¾Œè™•ç†
- **Text2VideoStrategy**: ç„¡å¾Œè™•ç†

---

## é…ç½®åƒæ•¸å„ªå…ˆç´š

é…ç½®åƒæ•¸çš„åˆä½µé †åºï¼ˆå„ªå…ˆç´šå¾é«˜åˆ°ä½ï¼‰ï¼š

1. **éšæ®µç‰¹å®šé…ç½®**ï¼ˆä¾‹å¦‚ï¼š`strategies.text2image2video.first_stage`ï¼‰
2. **ç­–ç•¥ç‰¹å®šé…ç½®**ï¼ˆä¾‹å¦‚ï¼š`strategies.text2image2video`ï¼‰
3. **é€šç”¨é…ç½®**ï¼ˆ`general`ï¼‰
4. **Config å±¬æ€§**ï¼ˆ`config.xxx`ï¼‰
5. **é è¨­å€¼**

é€™ç¢ºä¿äº†æ›´ç´°ç²’åº¦çš„é…ç½®å¯ä»¥è¦†è“‹æ›´é€šç”¨çš„é…ç½®ã€‚

---

## ç¤¾ç¾¤åª’é«”æ ¼å¼æ”¯æ´

### Instagram æ ¼å¼è½‰æ›

Instagram ä¸æ”¯æ´ç›´æ¥ä¸Šå‚³ GIF æ ¼å¼ï¼Œç³»çµ±æœƒè‡ªå‹•å°‡ GIF è½‰æ›ç‚º MP4 æ ¼å¼å¾Œå†ä¸Šå‚³ã€‚

**è‡ªå‹•è½‰æ›æµç¨‹**ï¼š
1. æª¢æ¸¬åˆ° GIF æª”æ¡ˆæ™‚ï¼Œè‡ªå‹•ä½¿ç”¨ FFmpeg è½‰æ›ç‚º MP4
2. è½‰æ›å¾Œçš„ MP4 æª”æ¡ˆæœƒåœ¨ä¸Šå‚³å®Œæˆå¾Œè‡ªå‹•æ¸…ç†
3. ç›´æ¥è½‰æ› GIF ä¸€æ¬¡ï¼ˆä¸ä½¿ç”¨å¾ªç’°è¼¸å…¥ï¼Œé¿å…è½‰æ›å¡ä½ï¼‰

**è½‰æ›åƒæ•¸**ï¼š
- FPS: è‡ªå‹•å¾ GIF æª”æ¡ˆè®€å–ï¼ˆä½¿ç”¨ ffprobeï¼Œ30 ç§’è¶…æ™‚ï¼‰ï¼Œè®€å–å¤±æ•—æ™‚ä½¿ç”¨é è¨­å€¼ 10
- Pixel Format: yuv420pï¼ˆç¢ºä¿ç›¸å®¹æ€§ï¼‰
- ä¸ä½¿ç”¨ `-stream_loop`ï¼šé¿å…ç„¡é™å¾ªç’°å°è‡´è½‰æ›å¡ä½ï¼Œç›´æ¥è½‰æ› GIF ä¸€æ¬¡å³å¯
- `-movflags faststart`ï¼šå„ªåŒ–ä¸²æµæ’­æ”¾
- Timeout: 2 åˆ†é˜è¶…æ™‚ä¿è­·ï¼Œé¿å…è½‰æ›éç¨‹å¡ä½

**é‡è¦ä¿®å¾©**ï¼š
- ç§»é™¤äº† `-stream_loop` åƒæ•¸ï¼Œé€™æ˜¯å°è‡´è½‰æ›å¡ä½çš„æ ¹æœ¬åŸå› 
- Instagram æœƒè‡ªå‹•å¾ªç’°æ’­æ”¾ MP4ï¼Œä¸éœ€è¦åœ¨è½‰æ›æ™‚å¾ªç’°è¼¸å…¥

### GIF å„ªåŒ–åŠŸèƒ½

ç³»çµ±åœ¨ç”Ÿæˆ LINE è²¼åœ– GIF æ™‚æœƒè‡ªå‹•é€²è¡Œå„ªåŒ–ï¼š

**å„ªåŒ–é …ç›®**ï¼š
- **å‹•ä½œè£œå¹€**ï¼šä½¿ç”¨ `minterpolate` é€²è¡Œå¹€æ’å€¼ï¼Œè®“å‹•ç•«æ›´æµæš¢è‡ªç„¶
- **èª¿è‰²æ¿å„ªåŒ–**ï¼šä½¿ç”¨äºŒéšæ®µè½‰æ›ï¼Œæœ€ä½³åŒ–æª”æ¡ˆå¤§å°
- **è§£æåº¦èª¿æ•´**ï¼šè‡ªå‹•ç¸®æ”¾ä»¥ç¬¦åˆè²¼åœ–æ¨™æº–

**é…ç½®åƒæ•¸**ï¼ˆåœ¨ `sticker_pack.animated_config` ä¸­ï¼‰ï¼š
```yaml
animated_config:
  gif_fps: 10             # GIF æ’­æ”¾å¹€ç‡
  gif_max_colors: 256     # æœ€å¤§é¡è‰²æ•¸
  gif_scale_width: 512    # å¯¬åº¦ï¼ˆé«˜åº¦è‡ªå‹•è¨ˆç®—ï¼‰
```

---

## åŠ æ¬Šéš¨æ©Ÿé¸æ“‡åŠŸèƒ½

ç³»çµ±æ”¯æ´å…©å€‹é‡è¦çš„åŠ æ¬Šéš¨æ©Ÿé¸æ“‡åŠŸèƒ½ï¼š
1. **Image System Prompt Weights** - æè¿°ç”Ÿæˆç³»çµ±æç¤ºè©çš„åŠ æ¬Šé¸æ“‡
2. **Style Weights** - è¦–è¦ºé¢¨æ ¼çš„åŠ æ¬Šé¸æ“‡

é€™å…©å€‹åŠŸèƒ½ä½¿å¾—å…§å®¹ç”Ÿæˆæ›´åŠ å¤šæ¨£åŒ–å’Œå¯æ§ã€‚

---

## Two Character Interaction åŠŸèƒ½

### æ¦‚è¿°

Two Character Interaction æ˜¯ä¸€å€‹ç‰¹æ®Šçš„åœ–ç‰‡æè¿°ç”Ÿæˆç³»çµ±ï¼Œç”¨æ–¼ç”Ÿæˆå…©å€‹è§’è‰²äº’å‹•çš„å ´æ™¯ã€‚

### æ”¯æ´ç­–ç•¥

âœ… **å·²æ”¯æ´** (2025-12-17 ä¿®å¾©):
- `Text2ImageStrategy` - æ–‡å­—ç”Ÿæˆåœ–ç‰‡
- `Text2Image2ImageStrategy` - æ–‡å­—â†’åœ–ç‰‡â†’åœ–ç‰‡
- `Text2Image2VideoStrategy` - æ–‡å­—â†’åœ–ç‰‡â†’å½±ç‰‡  
- `Text2VideoStrategy` - æ–‡å­—ç”Ÿæˆå½±ç‰‡ï¼ˆè§’è‰²æè¿°éšæ®µï¼‰

âŒ **ä¸æ”¯æ´**:
- `Text2LongVideoStrategy` - é•·å½±ç‰‡ï¼ˆä½¿ç”¨è…³æœ¬ç”Ÿæˆç³»çµ±ï¼‰
- `Text2LongVideoFirstFrameStrategy` - é•·å½±ç‰‡é¦–å¹€æ¨¡å¼ï¼ˆä½¿ç”¨è…³æœ¬ç”Ÿæˆç³»çµ±ï¼‰
- `Image2ImageStrategy` - åœ–ç‰‡â†’åœ–ç‰‡ï¼ˆå¾ç¾æœ‰åœ–ç‰‡æå–å…§å®¹ï¼‰
- `StickerPackStrategy` - è²¼åœ–åŒ…ï¼ˆä½¿ç”¨å°ˆç”¨è¡¨æƒ…ç³»çµ±ï¼‰

### ä½¿ç”¨æ–¹å¼

åœ¨è§’è‰²é…ç½®æª”æ¡ˆä¸­ï¼Œä½¿ç”¨ `image_system_prompt_weights` ä¾†è¨­å®š two character interaction çš„æ©Ÿç‡ï¼š

```yaml
generation:
  # å…¨åŸŸè¨­å®šï¼ˆæ‰€æœ‰ç­–ç•¥ï¼‰
  image_system_prompt_weights:
    stable_diffusion_prompt: 0.3
    warm_scene_description_system_prompt: 0.3
    sticker_prompt_system_prompt: 0.4
    two_character_interaction_generate_system_prompt: 0.3  # 30% æ©Ÿç‡
```

æˆ–é‡å°ç‰¹å®šç­–ç•¥è¨­å®šï¼š

```yaml
additional_params:
  strategies:
    text2image2video:
      first_stage:
        image_system_prompt_weights:
          stable_diffusion_prompt: 0.3
          two_character_interaction_generate_system_prompt: 0.7  # 70% æ©Ÿç‡
```

### Secondary Character ä¾†æº

ç•¶ç³»çµ±é¸æ“‡ä½¿ç”¨ two character interaction æ™‚ï¼Œæœƒè‡ªå‹•é¸æ“‡ç¬¬äºŒè§’è‰²ï¼š

1. **å„ªå…ˆ**ï¼šå¾ `config.secondary_character` ç²å–ï¼ˆå¦‚æœæœ‰æŒ‡å®šï¼‰
2. **æ¬¡è¦**ï¼šå¾è³‡æ–™åº«ä¸­éš¨æ©Ÿé¸æ“‡èˆ‡ä¸»è§’è‰²ä¸åŒçš„è§’è‰²
3. **å›é€€**ï¼šå¦‚æœç„¡æ³•ç²å–ï¼Œå‰‡ä½¿ç”¨é è¨­çš„åœ–ç‰‡ç”Ÿæˆæ–¹æ³•

### å¯¦ç¾ç´°ç¯€

- åŸºé¡ `ContentStrategy` æä¾› `_get_system_prompt()` æ–¹æ³•ï¼Œæ”¯æ´åŠ æ¬Šéš¨æ©Ÿé¸æ“‡
- æ‰€æœ‰ç­–ç•¥ç¹¼æ‰¿é€™å€‹æ–¹æ³•ï¼Œç‰¹æ®Šéœ€æ±‚çš„ç­–ç•¥å¯ä»¥è¦†å¯«
- ç³»çµ±æœƒæ ¹æ“šæ¬Šé‡éš¨æ©Ÿé¸æ“‡ system prompt
- ç•¶é¸ä¸­ `two_character_interaction_generate_system_prompt` æ™‚ï¼š
  - èª¿ç”¨ `_generate_two_character_interaction_description()` æ–¹æ³•
  - è©²æ–¹æ³•æœƒç²å– secondary character
  - ä½¿ç”¨ `vision_manager.generate_two_character_interaction_prompt()` ç”Ÿæˆå ´æ™¯æè¿°
- ç”Ÿæˆçš„æè¿°æœƒåŒ…å«å…©å€‹è§’è‰²çš„äº’å‹•ç´°ç¯€ï¼ˆå‹•ä½œã€è¡¨æƒ…ã€ç’°å¢ƒç­‰ï¼‰

### é…ç½®å„ªå…ˆç´š

é…ç½®æŸ¥æ‰¾é †åºï¼ˆå¾é«˜åˆ°ä½ï¼‰ï¼š
1. éšæ®µç‰¹å®šé…ç½®ï¼š`strategies.{strategy_name}.{stage}.image_system_prompt_weights`
2. ç­–ç•¥ç‰¹å®šé…ç½®ï¼š`strategies.{strategy_name}.image_system_prompt_weights`
3. å…¨åŸŸé…ç½®ï¼š`generation.image_system_prompt_weights`
4. å–®ä¸€å€¼ï¼š`image_system_prompt`ï¼ˆä¸æ”¯æ´åŠ æ¬Šé¸æ“‡ï¼‰

---

## Seed ç®¡ç†åŠŸèƒ½

### exclude_sampler_node_ids åƒæ•¸ï¼ˆæ¨è–¦ï¼‰

ç•¶ workflow ä¸­åŒ…å«å¤šå€‹ KSampler ç¯€é»æ™‚ï¼Œå¯ä»¥åœ¨ `configs/workflow_config.yaml` é…ç½®æ–‡ä»¶ä¸­å°‡ workflow è·¯å¾‘æ˜ å°„åˆ°å°æ‡‰çš„ exclude é…ç½®ï¼Œé¿å…å…¶ seed è¢«è‡ªå‹•æ›´æ–°ã€‚

**å„ªé»**ï¼š
- âœ… é…ç½®èˆ‡ workflow ç¶å®šï¼Œæ›´æ› workflow æ™‚ä¸æœƒéºå¿˜é…ç½®
- âœ… ä¸ä¿®æ”¹ workflow JSONï¼Œä¿æŒ ComfyUI å…¼å®¹æ€§
- âœ… ä½¿ç”¨ node_id ç²¾ç¢ºæŒ‡å®šï¼Œä¸ä¾è³´ç¯€é»é †åº
- âœ… é…ç½®é›†ä¸­ç®¡ç†ï¼Œæ˜“æ–¼ç¶­è­·

**ä½¿ç”¨å ´æ™¯**ï¼š
- ç•¶ workflow ä¸­æœ‰å¤šå€‹æ¡æ¨£å™¨ï¼ˆä¾‹å¦‚ z-image + nova modelï¼‰æ™‚
- å¸Œæœ›æŸäº›æ¡æ¨£å™¨çš„ seed ä¿æŒå›ºå®šï¼Œè€Œå…¶ä»–æ¡æ¨£å™¨çš„ seed éš¨æ©Ÿ

**é…ç½®æ–¹å¼ï¼ˆæ¨è–¦ - åœ¨ workflow_config.yaml ä¸­ï¼‰**ï¼š

åœ¨ `configs/workflow_config.yaml` æ–‡ä»¶ä¸­æ·»åŠ  workflow è·¯å¾‘æ˜ å°„ï¼š

```yaml
workflows:
  # å®Œæ•´è·¯å¾‘åŒ¹é…
  "/app/configs/workflow/z_image_plus_nova_model.json":
    exclude_sampler_node_ids: ["80:44"]
    description: "z-image çš„ KSampler (80:44) ä¿æŒ seed å›ºå®šï¼Œnova çš„ KSampler (81:76) seed éš¨æ©Ÿ"
  
  # ç›¸å°è·¯å¾‘åŒ¹é…ï¼ˆæœƒåŒ¹é…æ‰€æœ‰ä»¥è©²è·¯å¾‘çµå°¾çš„ workflowï¼‰
  "configs/workflow/z_image_plus_nova_model.json":
    exclude_sampler_node_ids: ["80:44"]
  
  # æ–‡ä»¶ååŒ¹é…ï¼ˆæœƒåŒ¹é…æ‰€æœ‰åŒ…å«è©²æ–‡ä»¶åçš„ workflowï¼‰
  "z_image_plus_nova_model.json":
    exclude_sampler_node_ids: ["80:44"]
```

**é…ç½®åƒæ•¸èªªæ˜**ï¼š
- `exclude_sampler_node_ids`: è¦æ’é™¤çš„ç¯€é» ID åˆ—è¡¨ï¼ˆæ¨è–¦ä½¿ç”¨ï¼Œç²¾ç¢ºæŒ‡å®šï¼‰
- `exclude_sampler_indices`: è¦æ’é™¤çš„ç¯€é»ç´¢å¼•åˆ—è¡¨ï¼ˆå‚™é¸æ–¹æ¡ˆï¼ŒåŸºæ–¼ç¯€é»é †åºï¼‰
- `description`: å¯é¸çš„æè¿°æ–‡å­—ï¼Œç”¨æ–¼èªªæ˜é…ç½®ç”¨é€”

**åŒ¹é…å„ªå…ˆç´š**ï¼š
1. å®Œæ•´è·¯å¾‘åŒ¹é…
2. ç›¸å°è·¯å¾‘åŒ¹é…ï¼ˆè·¯å¾‘çµå°¾åŒ¹é…ï¼‰
3. æ–‡ä»¶ååŒ¹é…

**å‚™é¸é…ç½®æ–¹å¼ï¼ˆåœ¨ YAML é…ç½®æ–‡ä»¶ä¸­ï¼‰**ï¼š

å¦‚æœç„¡æ³•ä¿®æ”¹ `workflow_config.yaml`ï¼Œä¹Ÿå¯ä»¥åœ¨ç­–ç•¥é…ç½®ä¸­ä½¿ç”¨ `exclude_sampler_indices`ï¼š

```yaml
strategies:
  text2img:
    exclude_sampler_indices: [0]  # æ’é™¤ç¬¬ä¸€å€‹ KSamplerï¼Œä¿æŒå…¶ seed å›ºå®š
```

**æ³¨æ„**ï¼š
- å„ªå…ˆç´šï¼š`workflow_config.yaml` ä¸­çš„é…ç½® > YAML é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®
- æ¨è–¦ä½¿ç”¨ `exclude_sampler_node_ids`ï¼Œå› ç‚ºå®ƒä¸ä¾è³´ç¯€é»é †åºï¼Œæ›´ç©©å®š
- åªæœ‰æœªè¢«æ’é™¤çš„ KSampler æœƒè‡ªå‹•æ›´æ–° seed
- ç³»çµ±æœƒè‡ªå‹•æ ¹æ“š workflow è·¯å¾‘æŸ¥æ‰¾å°æ‡‰çš„é…ç½®

---

## Style Weights åŠŸèƒ½

### æ¦‚è¿°

Style Weights å…è¨±ç³»çµ±æ ¹æ“šæ¬Šé‡éš¨æ©Ÿé¸æ“‡è¦–è¦ºé¢¨æ ¼ï¼Œè®“ç”Ÿæˆçš„å…§å®¹æ›´åŠ å¤šæ¨£åŒ–ã€‚

### æ”¯æ´ç­–ç•¥

âœ… **å…¨éƒ¨æ”¯æ´** (2025-12-17 ä¿®å¾©):
- `Text2ImageStrategy` - æ–‡å­—ç”Ÿæˆåœ–ç‰‡
- `Text2Image2ImageStrategy` - æ–‡å­—â†’åœ–ç‰‡â†’åœ–ç‰‡
- `Text2Image2VideoStrategy` - æ–‡å­—â†’åœ–ç‰‡â†’å½±ç‰‡
- `Text2VideoStrategy` - æ–‡å­—ç”Ÿæˆå½±ç‰‡
- `Text2LongVideoStrategy` - é•·å½±ç‰‡ï¼ˆå°¾å¹€é©…å‹•ï¼‰
- `Text2LongVideoFirstFrameStrategy` - é•·å½±ç‰‡ï¼ˆé¦–å¹€é©…å‹•ï¼‰
- `Image2ImageStrategy` - åœ–ç‰‡â†’åœ–ç‰‡
- `StickerPackStrategy` - è²¼åœ–åŒ…

### ä½¿ç”¨æ–¹å¼

åœ¨è§’è‰²é…ç½®æª”æ¡ˆä¸­ï¼Œä½¿ç”¨ `style_weights` ä¾†è¨­å®šä¸åŒé¢¨æ ¼çš„æ©Ÿç‡ï¼š

```yaml
generation:
  # å…¨åŸŸé¢¨æ ¼è¨­å®šï¼ˆæ‰€æœ‰ç­–ç•¥ï¼‰
  style_weights:
    "minimalism style with pure background": 0.2
    "watercolor painting style with pure background": 0.1
    "A highly saturated, dreamy-colored digital illustration style": 0.3
    "": 0.4  # ç©ºå­—ä¸²è¡¨ç¤ºä¸åŠ é¢¨æ ¼æç¤ºè©
```

æˆ–é‡å°ç‰¹å®šç­–ç•¥è¨­å®šï¼š

```yaml
additional_params:
  strategies:
    text2image2video:
      first_stage:
        style_weights:
          "minimalism style with pure background": 0.8
          "": 0.2
```

### å¯¦ç¾ç´°ç¯€

- åŸºé¡ `ContentStrategy` æä¾› `_get_style()` æ–¹æ³•ï¼Œæ”¯æ´åŠ æ¬Šéš¨æ©Ÿé¸æ“‡
- æ‰€æœ‰ç­–ç•¥ç¹¼æ‰¿é€™å€‹æ–¹æ³•ï¼Œç‰¹æ®Šéœ€æ±‚çš„ç­–ç•¥å¯ä»¥è¦†å¯«ï¼ˆå¦‚ `StickerPackStrategy`ï¼‰
- ç³»çµ±æœƒæ ¹æ“šæ¬Šé‡éš¨æ©Ÿé¸æ“‡é¢¨æ ¼
- é¸ä¸­çš„é¢¨æ ¼æœƒè¢«æ·»åŠ åˆ° prompt ä¸­ï¼š`{prompt}\nstyle: {style}`
- å¦‚æœé¸ä¸­ç©ºå­—ä¸² `""`ï¼Œå‰‡ä¸æ·»åŠ é¢¨æ ¼æç¤ºè©
- æ¯æ¬¡ç”Ÿæˆæ™‚éƒ½æœƒé‡æ–°éš¨æ©Ÿé¸æ“‡

### ä»£ç¢¼æ¶æ§‹

**åŸºé¡å¯¦ç¾** (`base_strategy.py`):
```python
def _get_style(self, stage_config: Dict[str, Any], default: str = '') -> str:
    """ç²å–è¦–è¦ºé¢¨æ ¼ï¼Œæ”¯æ´åŠ æ¬Šéš¨æ©Ÿé¸æ“‡"""
    weights = stage_config.get('style_weights')
    if weights:
        choices = list(weights.keys())
        probs = list(weights.values())
        total = sum(probs)
        if total > 0:
            probs = [p/total for p in probs]
            return np.random.choice(choices, p=probs)
    return self._get_config_value(stage_config, 'style', default)
```

**ç‰¹æ®Šç­–ç•¥è¦†å¯«** (ä¾‹å¦‚ `sticker_pack.py`):
```python
def _get_style(self, stage_config):
    """è¦†å¯«åŸºé¡æ–¹æ³•ä»¥ä½¿ç”¨ä¸åŒçš„é»˜èªå€¼"""
    return super()._get_style(stage_config, 
        default='LINE sticker style, chibi proportions, white outline...')
```

é€™ç¨®è¨­è¨ˆï¼š
- âœ… æ¸›å°‘ä»£ç¢¼é‡è¤‡
- âœ… æé«˜å¯ç¶­è­·æ€§
- âœ… ä¿æŒå½ˆæ€§ï¼ˆå­é¡å¯è¦†å¯«ï¼‰
- âœ… çµ±ä¸€è¡Œç‚ºï¼ˆæ‰€æœ‰ç­–ç•¥ä½¿ç”¨ç›¸åŒé‚è¼¯ï¼‰

### é…ç½®å„ªå…ˆç´š

é…ç½®æŸ¥æ‰¾é †åºï¼ˆå¾é«˜åˆ°ä½ï¼‰ï¼š
1. éšæ®µç‰¹å®šé…ç½®ï¼š`strategies.{strategy_name}.{stage}.style_weights`
2. ç­–ç•¥ç‰¹å®šé…ç½®ï¼š`strategies.{strategy_name}.style_weights`
3. å…¨åŸŸé…ç½®ï¼š`generation.style_weights`
4. å–®ä¸€å€¼ï¼š`style`ï¼ˆä¸æ”¯æ´åŠ æ¬Šé¸æ“‡ï¼‰

### èˆ‡ image_system_prompt_weights çš„é—œä¿‚

é€™å…©å€‹åŠŸèƒ½æ˜¯**ç¨ç«‹çš„**ï¼š
- `image_system_prompt_weights` æ§åˆ¶**å¦‚ä½•ç”Ÿæˆæè¿°**ï¼ˆä½¿ç”¨å“ªå€‹ç³»çµ±æç¤ºè©ï¼‰
- `style_weights` æ§åˆ¶**ç”Ÿæˆä»€éº¼é¢¨æ ¼çš„æè¿°**ï¼ˆè¦–è¦ºé¢¨æ ¼ï¼‰

å®ƒå€‘å¯ä»¥åŒæ™‚ä½¿ç”¨ï¼Œç³»çµ±æœƒï¼š
1. å…ˆæ ¹æ“š `image_system_prompt_weights` é¸æ“‡ç³»çµ±æç¤ºè©
2. å†æ ¹æ“š `style_weights` é¸æ“‡é¢¨æ ¼
3. å°‡é¢¨æ ¼æ·»åŠ åˆ° prompt ä¸­
4. ä½¿ç”¨é¸å®šçš„ç³»çµ±æç¤ºè©å’Œ prompt ç”Ÿæˆæè¿°

---

## å¸¸è¦‹å•é¡Œ

### Q: åœ¨ Jupyter Notebook ä¸­å‡ºç¾ `NameError: name '__file__' is not defined` éŒ¯èª¤ï¼Ÿ

A: åœ¨ Jupyter Notebook ç’°å¢ƒä¸­ï¼Œ`__file__` è®Šæ•¸ä¸å­˜åœ¨ã€‚`all_strategies_examples.ipynb` å·²ç¶“ä¿®æ­£æ­¤å•é¡Œï¼š
- Cell 2 ä¸­å®šç¾©äº†å…¨å±€ `project_root` è®Šæ•¸
- `build_config_for_strategy` å‡½æ•¸ä½¿ç”¨ `global project_root` ä¾†å­˜å–å°ˆæ¡ˆè·¯å¾‘
- ç¢ºä¿æŒ‰é †åºåŸ·è¡Œ Cell 2ï¼ˆç’°å¢ƒåˆå§‹åŒ–ï¼‰å¾Œå†åŸ·è¡Œå…¶ä»– Cell

### Q: ä»€éº¼æ˜¯ã€Œå¯©æ ¸ã€ï¼Ÿ

A: **å¯©æ ¸ = ä¸Šå‚³åª’é«”åˆ° Discordï¼Œè®“ä½¿ç”¨è€…äººå·¥é¸æ“‡è¦ä½¿ç”¨çš„åª’é«”**ã€‚é€™ä¸æ˜¯è‡ªå‹•é¸æ“‡æˆ– LLM åˆ†æï¼Œè€Œæ˜¯äººå·¥å¯©æ ¸æµç¨‹ï¼Œç¢ºä¿æœ€çµ‚ç™¼å¸ƒçš„å…§å®¹éƒ½ç¶“éä½¿ç”¨è€…ç¢ºèªã€‚

### Q: ç‚ºä»€éº¼æ‰€æœ‰ç­–ç•¥éƒ½éœ€è¦å¯©æ ¸ï¼Ÿ

A: ç‚ºäº†ç¢ºä¿æœ€çµ‚ç™¼å¸ƒåˆ°ç¤¾ç¾¤åª’é«”çš„å…§å®¹éƒ½ç¶“éä½¿ç”¨è€…ç¢ºèªã€‚æ¯å€‹ç­–ç•¥åœ¨ç”Ÿæˆåª’é«”å¾Œï¼Œéƒ½æœƒ**ä¸Šå‚³åˆ° Discord è®“ä½¿ç”¨è€…é¸æ“‡**æœ€çµ‚è¦ç™¼å¸ƒçš„å…§å®¹ã€‚

### Q: ç‚ºä»€éº¼ Text2Image2VideoStrategy éœ€è¦å…©æ¬¡å¯©æ ¸ï¼Ÿ

A: å› ç‚ºå®ƒåˆ†ç‚ºå…©å€‹éšæ®µï¼š
1. ç¬¬ä¸€éšæ®µç”Ÿæˆå¤šå¼µå€™é¸åœ–ç‰‡ï¼Œä½¿ç”¨è€…é¸æ“‡è¦ç”Ÿæˆå½±ç‰‡çš„åœ–ç‰‡
2. ç¬¬äºŒéšæ®µç”Ÿæˆå½±ç‰‡å¾Œï¼Œä½¿ç”¨è€…é¸æ“‡æœ€çµ‚è¦ç™¼å¸ƒçš„å½±ç‰‡

### Q: ç‚ºä»€éº¼ Text2LongVideoStrategy éœ€è¦å…©æ¬¡å¯©æ ¸ï¼Ÿ

A: å› ç‚ºå®ƒåˆ†ç‚ºå…©å€‹éšæ®µï¼š
1. ç¬¬ä¸€éšæ®µç”Ÿæˆå€™é¸åœ–ç‰‡ï¼Œä½¿ç”¨è€…é¸æ“‡ç¬¬ä¸€å¹€åœ–ç‰‡
2. ç¬¬äºŒéšæ®µç”Ÿæˆå®Œæ•´å½±ç‰‡å¾Œï¼Œä½¿ç”¨è€…é¸æ“‡æœ€çµ‚è¦ç™¼å¸ƒçš„å½±ç‰‡

### Q: å¯©æ ¸æ™‚é¸æ“‡çš„ç´¢å¼•æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ

A: `selected_indices` æ˜¯ç›¸å°æ–¼ `get_review_items()` è¿”å›åˆ—è¡¨çš„ç´¢å¼•ã€‚åœ¨ `handle_review_result()` ä¸­ï¼Œç­–ç•¥æœƒå°‡é€™äº›ç´¢å¼•æ˜ å°„åˆ°å¯¦éš›çš„åª’é«”è·¯å¾‘ã€‚

### Q: ç‚ºä»€éº¼æœ‰äº›ç­–ç•¥å»¶é²ç”Ÿæˆæ–‡ç« å…§å®¹ï¼Ÿ

A: å› ç‚ºæ–‡ç« å…§å®¹æ‡‰è©²åŸºæ–¼æœ€çµ‚çš„åª’é«”ï¼ˆä¾‹å¦‚ï¼šå½±ç‰‡ï¼‰ç”Ÿæˆï¼Œè€Œä¸æ˜¯ä¸­é–“ç”¢ç‰©ï¼ˆä¾‹å¦‚ï¼šåœ–ç‰‡ï¼‰ã€‚Text2Image2VideoStrategy åœ¨å½±ç‰‡ç”Ÿæˆå¾Œæ‰ç”Ÿæˆæ–‡ç« å…§å®¹ï¼Œç¢ºä¿å…§å®¹èˆ‡æœ€çµ‚åª’é«”åŒ¹é…ã€‚

### Q: å¦‚ä½•ç¢ºä¿å¯©æ ¸å¾Œæ­£ç¢ºæå–åª’é«”è·¯å¾‘ï¼Ÿ

A: ä½¿ç”¨ `selected_result_already_filtered` æ¨™è¨˜ä¾†å€åˆ†å…©ç¨®æƒ…æ³ï¼š
- å¦‚æœå·²éæ¿¾ï¼šç›´æ¥å¾ `selected_result` æå–
- å¦‚æœæœªéæ¿¾ï¼šä½¿ç”¨ `selected_indices` ç´¢å¼• `selected_result`

é€™ç¢ºä¿äº†ç„¡è«–å¯©æ ¸æµç¨‹å¦‚ä½•ï¼Œéƒ½èƒ½æ­£ç¢ºæå–ä½¿ç”¨è€…é¸æ“‡çš„åª’é«”ã€‚

### Q: Instagram ç™»å…¥æ™‚å‡ºç¾ã€Œæ‰¾ä¸åˆ°å¸³è™Ÿã€éŒ¯èª¤ï¼Ÿ

A: å¦‚æœå‡ºç¾ `We can't find an account with {username}` éŒ¯èª¤ï¼Œå¯èƒ½åŸå› ï¼š

1. **ä½¿ç”¨è€…åç¨±æ ¼å¼ä¸æ­£ç¢º**ï¼šInstagram API çš„ `IG_USERNAME` æ¬„ä½å¯ä»¥æ¥å—ï¼š
   - ä½¿ç”¨è€…åç¨±ï¼ˆä¾‹å¦‚ï¼š`wobbuffet_mao_66666`ï¼‰
   - Emailï¼ˆä¾‹å¦‚ï¼š`your_email@example.com`ï¼‰
   - é›»è©±è™Ÿç¢¼ï¼ˆä¾‹å¦‚ï¼š`+886912345678`ï¼‰

2. **å»ºè­°è§£æ±ºæ–¹æ¡ˆ**ï¼š
   - å¦‚æœä½¿ç”¨ä½¿ç”¨è€…åç¨±ç™»å…¥å¤±æ•—ï¼Œè«‹å˜—è©¦ä½¿ç”¨ **email** ç™»å…¥
   - æª¢æŸ¥ `configs/social_media/credentials/{character_name}/ig.env` ä¸­çš„ `IG_USERNAME` è¨­å®š
   - ç¢ºèªå¸³è™Ÿæ˜¯å¦éœ€è¦é©—è­‰ï¼ˆæª¢æŸ¥é›»å­éƒµä»¶æˆ–ç°¡è¨Šï¼‰
   - ç¢ºèªå¸³è™Ÿæœªè¢«åœç”¨æˆ–åˆªé™¤

3. **é…ç½®ç¯„ä¾‹**ï¼š
   ```env
   # ä½¿ç”¨ email ç™»å…¥ï¼ˆæ¨è–¦ï¼‰
   IG_USERNAME=your_email@example.com
   IG_PASSWORD=your_password
   
   # æˆ–ä½¿ç”¨é›»è©±è™Ÿç¢¼
   IG_USERNAME=+886912345678
   IG_PASSWORD=your_password
   ```

4. **æ³¨æ„**ï¼šå¦‚æœèƒ½åœ¨ UI ä»‹é¢ç™»å…¥ä½†ç¨‹å¼ç¢¼ç„¡æ³•ç™»å…¥ï¼Œé€šå¸¸æ˜¯å› ç‚ºï¼š
   - UI å¯èƒ½ä½¿ç”¨ email ç™»å…¥ï¼Œè€Œé…ç½®æª”æ¡ˆä½¿ç”¨çš„æ˜¯ä½¿ç”¨è€…åç¨±
   - Instagram API å°æŸäº›ä½¿ç”¨è€…åç¨±æ ¼å¼çš„æ”¯æ´å¯èƒ½æœ‰é™åˆ¶

## ğŸ”§ éŒ¯èª¤ä¿®å¾©è¨˜éŒ„

### é›™è§’è‰²äº’å‹•ç²å– Secondary Role è¿”å› None (2025-12-17)

**å•é¡Œ**: ä½¿ç”¨é›™è§’è‰²äº’å‹•ç³»çµ±æç¤ºè©æ™‚ï¼Œ`_get_random_secondary_character` æ–¹æ³•è¿”å› `None`ï¼Œå°è‡´ç„¡æ³•ç”Ÿæˆé›™è§’è‰²äº’å‹•æè¿°ã€‚

**æ ¹æœ¬åŸå› **:
ç³»çµ±åœ¨æŸ¥è©¢åŒç¾¤çµ„çš„å…¶ä»–è§’è‰²æ™‚ï¼Œä½¿ç”¨äº†**éš¨æ©Ÿé¸å‡ºçš„è§’è‰²**ï¼ˆå¦‚ `metaknight`ï¼‰è€Œä¸æ˜¯**ç¾¤çµ„ä»£è¡¨è§’è‰²**ï¼ˆå¦‚ `kirby`ï¼‰ã€‚

**åŸ·è¡Œæµç¨‹èªªæ˜**:
1. `orchestration_service` å¾ç¾¤çµ„ `Kirby` ä¸­éš¨æ©Ÿé¸æ“‡äº† `MetaKnight` ä½œç‚ºä¸»è§’è‰²
2. åœ¨ `_get_random_secondary_character` ä¸­ï¼Œä½¿ç”¨ `metaknight` å»æŸ¥è©¢åŒç¾¤çµ„çš„å…¶ä»–è§’è‰²
3. ä½†è³‡æ–™åº«æŸ¥è©¢æ‡‰è©²ä½¿ç”¨**ç¾¤çµ„ä»£è¡¨è§’è‰²**ï¼ˆ`kirby`ï¼‰ä¾†æŸ¥è©¢ï¼Œæ‰èƒ½æ‰¾åˆ°åŒç¾¤çµ„çš„æ‰€æœ‰è§’è‰²

**ä¿®å¾©æ–¹æ¡ˆ**:
1. åœ¨ `orchestration_service` ä¸­ï¼Œä¿å­˜åŸå§‹çš„ç¾¤çµ„ä»£è¡¨è§’è‰²ï¼ˆ`group_representative_character`ï¼‰
2. é€šé `config_dict` å‚³éçµ¦ `GenerationConfig`
3. åœ¨ `_get_random_secondary_character` ä¸­ï¼Œå„ªå…ˆä½¿ç”¨ `group_representative_character` é€²è¡Œè³‡æ–™åº«æŸ¥è©¢
4. éæ¿¾è§’è‰²æ™‚ï¼Œæ’é™¤**ç•¶å‰ä¸»è§’è‰²**ï¼ˆéš¨æ©Ÿé¸å‡ºçš„è§’è‰²ï¼‰

**ä¿®å¾©å…§å®¹**:
1. `orchestration_service.py`:
   - åœ¨è§’è‰²é¸æ“‡å‰ä¿å­˜ `group_representative_character = character.character`
   - å°‡å…¶åŠ å…¥ `config_dict['group_representative_character']`

2. `base_strategy.py`:
   - åœ¨ `_get_random_secondary_character` ä¸­ï¼Œä½¿ç”¨ `getattr(self.config, 'group_representative_character', main_character)` é€²è¡ŒæŸ¥è©¢
   - æ·»åŠ  DEBUG æ—¥èªŒé¡¯ç¤ºã€Œç•¶å‰ä¸»è§’è‰²ã€å’Œã€Œç¾¤çµ„ä»£è¡¨è§’è‰²ã€çš„å€åˆ¥
   - éæ¿¾æ™‚ä»ç„¶æ’é™¤ç•¶å‰ä¸»è§’è‰²ï¼ˆéš¨æ©Ÿé¸å‡ºçš„è§’è‰²ï¼‰

**å½±éŸ¿æª”æ¡ˆ**: 
- `lib/services/implementations/orchestration_service.py`
- `lib/media_auto/strategies/base_strategy.py`

**ç¯„ä¾‹**:
- ç¾¤çµ„ä»£è¡¨è§’è‰²: `kirby`
- éš¨æ©Ÿé¸å‡ºçš„ä¸»è§’è‰²: `metaknight`
- æŸ¥è©¢ä½¿ç”¨: `kirby`ï¼ˆç¾¤çµ„ä»£è¡¨è§’è‰²ï¼‰
- éæ¿¾æ’é™¤: `metaknight`ï¼ˆç•¶å‰ä¸»è§’è‰²ï¼‰
- å¯èƒ½çš„ Secondary Role: `waddle dee`, `king dedede` ç­‰

---

### TTS éŸ³è¨Šç”Ÿæˆ asyncio éŒ¯èª¤ (2025-12-17)

**å•é¡Œ**: Text2LongVideo ç­–ç•¥åœ¨ç”Ÿæˆ TTS éŸ³è¨Šæ™‚å‡ºç¾ `asyncio.run() cannot be called from a running event loop` éŒ¯èª¤

**åŸå› **: `TTSService.generate_speech_sync()` æ–¹æ³•åœ¨æª¢æ¸¬åˆ°é‹è¡Œä¸­çš„ event loop æ™‚ï¼Œæœƒåœ¨æ–°ç·šç¨‹ä¸­åŸ·è¡Œ async ä»»å‹™ã€‚ä½†åœ¨ç•°å¸¸è™•ç†çš„ `except RuntimeError` å€å¡Šä¸­ï¼Œä»ç„¶ä½¿ç”¨ `asyncio.run()`ï¼Œå°è‡´ç•¶æ²’æœ‰é‹è¡Œä¸­çš„ event loop æ™‚ä¹Ÿæœƒå¤±æ•—ã€‚

**ä¿®å¾©**: é‡æ§‹ `generate_speech_sync()` æ–¹æ³•ï¼Œå°‡åœ¨æ–°ç·šç¨‹ä¸­åŸ·è¡Œçš„é‚è¼¯æå–ç‚º `run_in_thread()` å‡½æ•¸ï¼Œä¸¦åœ¨å…©ç¨®æƒ…æ³ä¸‹éƒ½ä½¿ç”¨ï¼š
- æœ‰é‹è¡Œä¸­çš„ event loopï¼šåœ¨ç·šç¨‹æ± ä¸­åŸ·è¡Œ
- æ²’æœ‰é‹è¡Œä¸­çš„ event loopï¼šç›´æ¥åŸ·è¡Œ

**å½±éŸ¿æª”æ¡ˆ**: `lib/services/implementations/tts_service.py`