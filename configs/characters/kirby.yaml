# Kirby Long-Form Video Character Configuration
# =================================================================
# Extended configuration with long-form video generation support
# Based on kirby.yaml with added text2longvideo strategy

# Character Identity
# -----------------------------------------------------------------
character:
  name: kirby_longvideo  # Character identifier
  group_name: Kirby  # Character group

# Generation Settings
# -----------------------------------------------------------------
generation:
  output_dir: /app/output_media

  # Generation Type Weights
  # Added text2longvideo with 30% probability
  generation_type_weights:
    text2img: 1
    text2video: 0
    text2image2video: 2
    text2longvideo: 2
    image2image: 0
    text2image2image: 1
    sticker_pack: 3
    text2longvideo_firstframe: 2

  # Workflow Path Configuration
  workflows:
    text2img: /app/configs/workflow/nova-anime-xl.json
    text2video: /app/configs/workflow/wan2.1_t2v_audio.json
    text2image2video: /app/configs/workflow/wan2.2_gguf_i2v_audio.json
    image2image: /app/configs/workflow/image_to_image.json
    sticker_pack: /app/configs/workflow/nova-anime-xl.json

  # Quality Control
  similarity_threshold: 0.5

  # Prompt Generation Method Weights
  prompt_method_weights:
    arbitrary: 0.1
    news: 0.9

  # Image System Prompt Weights
  image_system_prompt_weights:
    stable_diffusion_prompt: 0.3
    warm_scene_description_system_prompt: 0.3
    sticker_prompt_system_prompt: 0.4
    two_character_interaction_generate_system_prompt: 0.3

  # Visual Style Weights
  style_weights:
    "minimalism style with pure background": 0.2
    "A highly saturated, dreamy-colored digital illustration style, utilizing soft volumetric lighting and meticulous detail rendering to portray dynamic/slice-of-life scenes of cute Chibi-style characters": 0.3
    "watercolor painting style with pure background": 0.1
    "": 0.4

# Social Media Configuration
# -----------------------------------------------------------------
social_media:
  default_hashtags:
    - カービィ
    - 星のカービィ
  
  platforms:
    instagram:
      config_folder_path: /app/configs/social_media/credentials/kirby
      enabled: true
    
    twitter:
      config_folder_path: /app/configs/social_media/credentials/kirby
      prefix: ""
      enabled: true

# Additional Generation Parameters
# -----------------------------------------------------------------
additional_params:
  is_negative: false

  # General Parameters (shared across all strategies)
  general:
    images_per_description: 4
    images_per_input: 2
    videos_per_description: 2
    videos_per_image: 1
    denoise: 0.6
    
    enable_upscale: true
    upscale_workflow_path: /app/configs/workflow/Tile Upscaler SDXL.json
    custom_node_updates: []

  # Strategy-Specific Parameters
  strategies:
    # Text-to-Image Strategy
    text2img:
      images_per_description: 6
      custom_node_updates:
        - node_type: "PrimitiveInt"
          inputs:
            value: 1024

    # Text-to-Image-to-Image Strategy
    text2image2image:
      first_stage:
        images_per_description: 4
        workflow_path: /app/configs/workflow/nova-anime-xl.json
      second_stage:
        images_per_input: 1
        workflow_path: /app/configs/workflow/image_to_image.json
        denoise: 0.7

    # Text-to-Image-to-Video Strategy
    text2image2video:
      first_stage:
        style: "minimalism style with pure background"
        image_system_prompt_weights:
          stable_diffusion_prompt: 0.3
          warm_scene_description_system_prompt: 0.3
          sticker_prompt_system_prompt: 0.4
        images_per_description: 3
        t2i_workflow_path: /app/configs/workflow/nova-anime-xl.json
        enable_upscale: true
        upscale_workflow_path: "configs/workflow/Tile Upscaler SDXL.json"
    
      
      video:
        i2v_workflow_path: /app/configs/workflow/wan2.2_gguf_i2v_audio.json
        videos_per_image: 2
        use_noise_seed: true
        custom_node_updates: []

    # ✨ NEW: Text-to-Long-Form-Video Strategy
    # =================================================================
    # Multi-segment video generation with frame continuity
    text2longvideo:
      # Long-video specific configuration
      longvideo_config:
        segment_count: 5              # Number of video segments (e.g., 5 segments × 5 seconds = 25 second video)
        segment_duration: 5           # Duration per segment in seconds
        use_tts: true                 # Enable TTS narration
        tts_voice: "en-US-AriaNeural"  # Edge-TTS voice (English female)
        # Available voices:
        # English: en-US-AriaNeural, en-US-GuyNeural, en-GB-SoniaNeural
        # Chinese: zh-CN-XiaoxiaoNeural, zh-TW-HsiaoChenNeural
        # Japanese: ja-JP-NanamiNeural
        tts_rate: "+0%"               # Speech rate: -50% to +50%
        fps: 16                       # Video frame rate

      # First Stage: Generate first-frame candidates (Text-to-Image)
      # User will select best candidate via Discord
      first_stage:
        workflow_path: /app/configs/workflow/nova-anime-xl.json
        batch_size: 3
        style: "minimalism style with pure background"
        enable_upscale: true
        upscale_workflow_path: "configs/workflow/Tile Upscaler SDXL.json"
        
        image_system_prompt_weights:
          stable_diffusion_prompt: 0.3
          warm_scene_description_system_prompt: 0.4
          sticker_prompt_system_prompt: 0.3
        
        custom_node_updates:
          - node_type: "PrimitiveInt"
            inputs:
              value: 1024  # Resolution for first frame

      # Video Generation: Sequential Image-to-Video for each segment
      # Each segment uses last frame of previous segment as input
      video_generation:
        workflow_path: /app/configs/workflow/wan2.2_gguf_i2v.json
        use_noise_seed: true

    sticker_pack:
      style: "LINE sticker style, chibi proportions, white outline, simple background"
      static_config:
        workflow_path: /app/configs/workflow/nova-anime-xl.json
        images_per_expression: 1
      animated_config:
        enabled: true
        i2v_workflow_path: /app/configs/workflow/wan2.2_gguf_i2v.json
        # Sticker GIF 專用參數（短動畫）
        total_frames: 36
        video_fps: 12
        gif_fps: 10             # GIF fps
        gif_max_colors: 256
        gif_scale_width: 512

    text2longvideo_firstframe:
      longvideo_config:
        segment_count: 5
        segment_duration: 5
        use_tts: true
        tts_voice: "en-US-AriaNeural"
      
      first_stage:
        workflow_path: /app/configs/workflow/nova-anime-xl.json
        batch_size: 3
        style: "minimalism style with pure background"
        enable_upscale: false
      
      # 關鍵：首幀轉換配置
      frame_transition:
        enabled: false
        workflow_path: /app/configs/workflow/image_to_image.json
        denoise: 0.7
      
      video_generation:
        workflow_path: /app/configs/workflow/wan2.2_gguf_i2v.json

